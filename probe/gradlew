#!/bin/sh

set -e

PRG="$0"
while [ -h "$PRG" ]; do
  ls=`ls -ld "$PRG"`
  link=`expr "$ls" : '.*-> \(.*\)$'`
  if expr "$link" : '/.*' > /dev/null; then
    PRG="$link"
  else
    PRG="`dirname "$PRG"`/$link"
  fi
done
SAVED="`pwd`"
cd "`dirname "$PRG"`" >/dev/null
APP_HOME="`pwd -P`"
cd "$SAVED" >/dev/null

WRAPPER_JAR="$APP_HOME/gradle/wrapper/gradle-wrapper.jar"
DISTRIBUTION_URL="https://services.gradle.org/distributions/gradle-8.10.2-bin.zip"
LAUNCHER_PATH="gradle-8.10.2/lib/gradle-launcher-8.10.2.jar"
TMP_ZIP="$APP_HOME/gradle/wrapper/gradle-dist.zip"

if [ ! -f "$WRAPPER_JAR" ]; then
  mkdir -p "`dirname "$WRAPPER_JAR"`"
  echo "Gradle wrapper jar missing, downloading from $DISTRIBUTION_URL" >&2
  if command -v curl >/dev/null 2>&1; then
    curl -fL "$DISTRIBUTION_URL" -o "$TMP_ZIP"
  elif command -v wget >/dev/null 2>&1; then
    wget -O "$TMP_ZIP" "$DISTRIBUTION_URL"
  else
    echo "Unable to download Gradle wrapper jar (curl or wget required)." >&2
    exit 1
  fi
  if command -v unzip >/dev/null 2>&1; then
    unzip -p "$TMP_ZIP" "$LAUNCHER_PATH" > "$WRAPPER_JAR"
  elif command -v jar >/dev/null 2>&1; then
    jar xf "$TMP_ZIP" "$LAUNCHER_PATH"
    mv "$APP_HOME/$LAUNCHER_PATH" "$WRAPPER_JAR"
    rmdir "$APP_HOME/gradle-8.10.2/lib" "$APP_HOME/gradle-8.10.2" 2>/dev/null || true
  else
    echo "Neither unzip nor jar is available to extract the Gradle launcher." >&2
    rm -f "$TMP_ZIP"
    exit 1
  fi
  rm -f "$TMP_ZIP"
fi

JAVA_EXEC=""
if [ -n "$JAVA_HOME" ]; then
  if [ -x "$JAVA_HOME/bin/java" ]; then
    JAVA_EXEC="$JAVA_HOME/bin/java"
  fi
fi

if [ -z "$JAVA_EXEC" ]; then
  JAVA_EXEC=`command -v java 2>/dev/null || true`
fi

if [ -z "$JAVA_EXEC" ]; then
  echo "Unable to find Java executable. Set JAVA_HOME or ensure java is on PATH." >&2
  exit 1
fi

CLASSPATH="$WRAPPER_JAR"

exec "$JAVA_EXEC" -classpath "$CLASSPATH" org.gradle.wrapper.GradleWrapperMain "$@"
