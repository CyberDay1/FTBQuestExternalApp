<UserControl
    x:Class="FTBQuestEditor.WinUI.Views.ChapterNavigator"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:vm="using:FTBQuestEditor.WinUI.ViewModels"
    xmlns:views="using:FTBQuestEditor.WinUI.Views">
    <UserControl.Resources>
        <BooleanToVisibilityConverter x:Key="BoolToVisibilityConverter" />
    </UserControl.Resources>
    <Grid>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="320" />
            <ColumnDefinition Width="*" />
        </Grid.ColumnDefinitions>

        <Grid Background="{ThemeResource LayerFillColorDefaultBrush}" CornerRadius="0" Padding="12">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto" />
                <RowDefinition Height="*" />
            </Grid.RowDefinitions>

            <TextBox
                x:Name="SearchBox"
                PlaceholderText="Search chapters"
                Text="{x:Bind ListViewModel.FilterText, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                Margin="0,0,0,12" />

            <TreeView
                x:Name="ChapterTree"
                Grid.Row="1"
                ItemsSource="{x:Bind ListViewModel.Nodes, Mode=OneWay}"
                SelectionMode="Single"
                ItemInvoked="OnTreeViewItemInvoked"
                SelectionChanged="OnTreeViewSelectionChanged"
                Expanding="OnTreeViewExpanding"
                Collapsed="OnTreeViewCollapsed">
                <TreeView.ItemTemplate>
                    <TreeViewNodeTemplate ItemsSource="{Binding Children}">
                        <Grid ColumnSpacing="8">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="Auto" />
                            </Grid.ColumnDefinitions>

                            <StackPanel Orientation="Horizontal" Spacing="8">
                                <TextBlock Text="{Binding Title}" />
                            </StackPanel>

                            <Border
                                Grid.Column="1"
                                Background="{ThemeResource SystemFillColorAttentionBackgroundBrush}"
                                Padding="4,0"
                                CornerRadius="8"
                                Visibility="{Binding HasIssues, Converter={StaticResource BoolToVisibilityConverter}}">
                                <TextBlock
                                    Text="{Binding BadgeGlyph}"
                                    FontWeight="Bold"
                                    Margin="0,-2,0,0" />
                            </Border>
                        </Grid>
                    </TreeViewNodeTemplate>
                </TreeView.ItemTemplate>
            </TreeView>
        </Grid>

        <views:GridViewPage x:Name="GridView" Grid.Column="1" />
    </Grid>
</UserControl>
